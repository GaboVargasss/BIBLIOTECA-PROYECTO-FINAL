{% extends 'base.html' %}
{% block title %}Libros – Hogwarts & Books{% endblock %}

{% block content %}
  <h2 class="mb-4 text-white">Gestión de Libros</h2>

  <!-- Mensaje de error -->
  <div id="errorAlert" class="alert alert-danger" style="display: none;"></div>

  {% if role=='admin' %}
    <div class="mb-4 text-center">
      <button id="btnAddNew" class="btn btn-success btn-glow">➕ Agregar libro</button>
    </div>

    <!-- Formulario oculto para añadir/editar (solo admin) -->
    <div id="formContainer" class="card-form mb-5" style="display:none;">
      <form id="bookForm" data-id="">
        {{ form.hidden_tag() }}
        <div class="row g-3">
          <div class="col-md-4">
            {{ form.title.label(class="form-label text-white") }}
            {{ form.title(class="form-control") }}
          </div>
          <div class="col-md-4">
            {{ form.author.label(class="form-label text-white") }}
            {{ form.author(class="form-control") }}
          </div>
          <div class="col-md-4">
            {{ form.category.label(class="form-label text-white") }}
            {{ form.category(class="form-select") }}
          </div>
          <div class="col-12">
            {{ form.description.label(class="form-label text-white") }}
            {{ form.description(class="form-control", rows=2) }}
          </div>
          <div class="col-12 text-end">
            <button type="button" id="btnCancel" class="btn btn-secondary me-2">Cancelar</button>
            <button type="button" id="btnSubmit" class="btn btn-custom btn-glow">Guardar</button>
          </div>
        </div>
      </form>
    </div>
  {% endif %}

  <!-- Presentación de libros -->
  <div class="container">
    {% if role=='admin' %}
      <!-- Reportes para admin -->
      <div class="row mb-4">
        <div class="col-md-6 mb-3">
          <div class="card bg-dark text-white h-100 report-card">
            <div class="card-header bg-primary">
              <h5 class="card-title mb-0">Historial de préstamos de un usuario</h5>
            </div>
            <div class="card-body">
              <p class="card-text">Consulta el historial completo de préstamos realizados por un usuario específico.</p>
              <button class="btn btn-sm btn-outline-light report-btn">Generar Reporte</button>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-3">
          <div class="card bg-dark text-white h-100 report-card">
            <div class="card-header bg-success">
              <h5 class="card-title mb-0">Inventario actual de copias disponibles</h5>
            </div>
            <div class="card-body">
              <p class="card-text">Muestra el listado de todas las copias de libros disponibles para préstamo.</p>
              <button class="btn btn-sm btn-outline-light report-btn">Generar Reporte</button>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-3">
          <div class="card bg-dark text-white h-100 report-card">
            <div class="card-header bg-warning">
              <h5 class="card-title mb-0">Usuarios con préstamos activos</h5>
            </div>
            <div class="card-body">
              <p class="card-text">Lista de usuarios que actualmente tienen libros prestados.</p>
              <button class="btn btn-sm btn-outline-light report-btn">Generar Reporte</button>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-3">
          <div class="card bg-dark text-white h-100 report-card">
            <div class="card-header bg-info">
              <h5 class="card-title mb-0">Usuarios que más han realizado préstamos</h5>
            </div>
            <div class="card-body">
              <p class="card-text">Ranking de usuarios con mayor cantidad de préstamos realizados.</p>
              <button class="btn btn-sm btn-outline-light report-btn">Generar Reporte</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla de libros para admin -->
      <div class="card p-3 bg-dark border-0">
        <div class="table-responsive">
          <table id="booksTable" class="table table-dark table-striped mb-0">
            <thead>
              <tr>
                <th class="text-white">ID</th>
                <th class="text-white">Título</th>
                <th class="text-white">Autor</th>
                <th class="text-white">Categoría</th>
                <th class="text-white">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% if books %}
                {% for b in books %}
                <tr>
                  <td class="text-white">{{ b.id }}</td>
                  <td class="text-white">{{ b.title }}</td>
                  <td class="text-white">{{ b.author }}</td>
                  <td class="text-white">{{ b.category.name if b.category else '—' }}</td>
                  <td>
                    <div class="d-flex gap-2">
                      <button class="btn btn-sm btn-warning edit-btn" onclick="editBook({ b.id })">
                        <i class="bi bi-pencil"></i> Editar
                      </button>
                      <button class="btn btn-sm btn-danger delete-btn" onclick="confirmDelete({ b.id })">
                        <i class="bi bi-trash"></i> Eliminar
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="text-center text-white">No se encontraron libros</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    {% else %}
      <!-- Grid de libros para visitantes/usuarios normales -->
<div id="booksContainer">
  {% if books %}
    <div class="row row-cols-1 row-cols-md-5 g-4" id="booksGrid">
      {% for b in books[:5] %}
      <div class="col">
        <div class="card h-100 book-card">
          {% if b.title == "La Casa de los Espíritus" %}
            <img src="https://th.bing.com/th/id/R.54d54b9e47b368c2dcbf822968528a1d?rik=ZWfmTXb8pPqdxw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Casa de los Espíritus">
          {% elif b.title == "Cien Años de Soledad" %}
            <img src="https://th.bing.com/th/id/R.938c16d580f65d466de44d9f2ec98732?rik=kqLcyYNhyB9XcQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Cien Años de Soledad">
          {% elif b.title == "Don Quijote de la Mancha" %}
            <img src="https://th.bing.com/th/id/OIP.p2Qht0iMCaSgQb3wbzHukAHaKN?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Don Quijote de la Mancha">
          {% elif b.title == "El Amor en los Tiempos del Cólera" %}
            <img src="https://th.bing.com/th/id/OIP.AH51t3XXwwUHzBcgAnRyDQHaLY?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="El Amor en los Tiempos del Cólera">
          {% elif b.title == "Pedro Páramo" %}
            <img src="https://th.bing.com/th/id/OIP._idAd91_g_NrtKCHOU3NpQAAAA?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Pedro Páramo">
          {% elif b.title == "Rayuela" %}
            <img src="https://th.bing.com/th/id/R.84d2ad6787f0eab3d2c35097777f1d41?rik=s5tX1clebD77gQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Rayuela">
          {% elif b.title == "La Ciudad y los Perros" %}
            <img src="https://th.bing.com/th/id/R.938c16d580f65d466de44d9f2ec98732?rik=kqLcyYNhyB9XcQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Ciudad y los Perros">
          {% elif b.title == "La Fiesta del Chivo" %}
            <img src="https://th.bing.com/th/id/R.1a5cfca15ff39f234282eb119fd9ee84?rik=iT5fIgNSMrqgdg&riu=http%3a%2f%2f2.bp.blogspot.com%2f-dGgVbVjfd3I%2fWLic0sp9tLI%2fAAAAAAAAHuU%2f3fzfr5883Gs068ZRNGl1HbwRk198uN-IgCK4B%2fs1600%2fla-fiesta-del-chivo.jpg&ehk=J5PI%2fAphwc7z%2bN2XE6bu7oFVw26fCYscXfZRfE1vNN8%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Fiesta del Chivo">
          {% elif b.title == "Crimen y Castigo" %}
            <img src="https://assets-global.website-files.com/6034d7d1f3e0f52c50b2adee/6254541d8ae4df16d4e69bc8_6034d7d1f3e0f54529b2b1a1_Crimen-y-castigo-fiodor-dostoyevski-editorial-alma.jpeg" class="card-img-top book-cover" alt="Crimen y Castigo">
          {% elif b.title == "Madame Bovary" %}
            <img src="https://th.bing.com/th/id/R.bfae76717b0269eeb79b473202a0c47f?rik=AD6SgLhBk9YufA&riu=http%3a%2f%2f2.bp.blogspot.com%2f-dZTo7vFU5ow%2fVgBoP_cpkgI%2fAAAAAAAAE2g%2fF1BlE189YuQ%2fs1600%2fmadame-bovary.jpg&ehk=JPl4eHVX08x5Tgr%2ffPp4KgNO6vMPfdcJhYyUKwXO%2bhw%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Madame Bovary">
          {% elif b.title == "La Metamorfosis" %}
            <img src="https://th.bing.com/th/id/OIP.i7Co-_uepnqacgo9X7Lp2wHaMI?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="La Metamorfosis">
          {% elif b.title == "El Nombre de la Rosa" %}
            <img src="https://pics.filmaffinity.com/El_nombre_de_la_rosa-932325619-large.jpg" class="card-img-top book-cover" alt="El Nombre de la Rosa">
          {% elif b.title == "Las Mil y Una Noches" %}
            <img src="https://th.bing.com/th/id/OIP.c6lMjK5WW7B5coR9RDHUEwHaJ9?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Las Mil y Una Noches">
          {% elif b.title == "El Señor de los Anillos: La Comunidad del Anillo" %}
            <img src="https://th.bing.com/th/id/OIP.vVvlRPaIUFhjugjPJmjiFQHaLF?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="El Señor de los Anillos: La Comunidad del Anillo">
          {% elif b.title == "El Hobbit" %}
            <img src="https://www.estudioenescarlata.com/media/img/portadas/_visd_0001JPG01O5Z.jpg" class="card-img-top book-cover" alt="El Hobbit">
          {% elif b.title == "1984" %}
            <img src="https://m.media-amazon.com/images/I/71kxa1-0mfL.jpg" class="card-img-top book-cover" alt="1984">
          {% elif b.title == "El túnel" %}
            <img src="https://porqueleer.es/wp-content/uploads/2023/06/El-tunel.jpg" class="card-img-top book-cover" alt="El túnel">
          {% elif b.title == "Ficciones" %}
            <img src="https://th.bing.com/th/id/R.f7836a820665a332a8b3abcc418f446c?rik=Jnu3ZckPOR9Opw&riu=http%3a%2f%2f1.bp.blogspot.com%2f-2V-Ej-Q5Vr4%2fVah77WezXTI%2fAAAAAAAAHdE%2f6jAuqM30438%2fs1600%2flibro_1362275865.jpg&ehk=tLBcZ1PTMEJML3tu7O%2f5VSyCfwRm9YIqG0bX%2bwW625g%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Ficciones">
          {% elif b.title == "El principito" %}
            <img src="https://th.bing.com/th/id/OIP.Jm3Yn4t7jbAfL2fXF6TUkwHaLX?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El principito">
          {% elif b.title == "Orgullo y Prejuicio" %}
            <img src="https://th.bing.com/th/id/R.c71f4e8aec2d03b0ad7834c89846b50d?rik=yr9NbChLTGEzsA&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Orgullo y Prejuicio">
          {% elif b.title == "La comunidad del anillo" %}
            <img src="https://th.bing.com/th/id/R.d60f3156fb891e7a61332ffa0d60c8d2?rik=bSqunlRYGoTimA&riu=http%3a%2f%2f4.bp.blogspot.com%2f-fwBFcc__Igk%2fU4YwkJlz71I%2fAAAAAAAACeA%2fn7nvHR3X1xM%2fs1600%2fLa%2bcomunidad%2bdel%2banillo.jpg&ehk=QZSSga710J%2f3i8PkBSJmpLO%2bcTxeZCkdTIGiTrIKTB4%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La comunidad del anillo">
          {% elif b.title == "Fahrenheit 451" %}
            <img src="https://4.bp.blogspot.com/-1SXcY6CyiSw/WMgz8y01BKI/AAAAAAAAT-o/amOlCA24jMgSJuV8bCQueeWRv-7J5JDuACLcB/s1600/ray-bradbury-fahrenheit-451-libro-portada.jpg" class="card-img-top book-cover" alt="Fahrenheit 451">
          {% elif b.title == "El Aleph" %}
            <img src="https://th.bing.com/th/id/OIP.bJE2g7_HVFBc403Q7CiF7QHaLT?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El Aleph">
          {% elif b.title == "La sombra del Viento" %}
            <img src="https://th.bing.com/th/id/R.9e164e1d45e52e0884b899450f2bd7d9?rik=Pgqo3wVlZhS%2bBw&riu=http%3a%2f%2f4.bp.blogspot.com%2f-BXXT1uAS9uE%2fU_i2i5W0t6I%2fAAAAAAAAAQ4%2frN2dhlUKFAo%2fs1600%2fla_sombra_del_viento.jpg&ehk=L1nhtFEb4MG7GeI0yjCcVqvbzVcqxVHDzC12QcFz3Mc%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La sombra del Viento">
          {% elif b.title == "Ensayo sobre la ceguera" %}
            <img src="https://th.bing.com/th/id/OIP.Hes3G_5KdnUScIC2yjU34QHaJ4?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="Ensayo sobre la ceguera">
          {% elif b.title == "La colmena" %}
            <img src="https://th.bing.com/th/id/OIP.OUS6-YvqEDuNCJphpI_HTwHaMR?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="La colmena">
          {% elif b.title == "La Tregua" %}
            <img src="https://th.bing.com/th/id/R.8f9365979c66a517c64a8a1a80816cf8?rik=LMFprrD2%2btmgWQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Tregua">
          {% elif b.title == "Conversacion en la catedral" %}
            <img src="https://th.bing.com/th/id/R.6de08f65576e8fcafa6a4d59b56aa5db?rik=EV48Kt%2fH8P2KVA&riu=http%3a%2f%2flabodeteca.com%2fweb%2fwp-content%2fuploads%2f2015%2f01%2fportada-conversacion-catedral_grande-1.jpg&ehk=jKqPrdrb8F0J3IcvtOz7V%2fVr6HWgnoekzfxoylNl51Y%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Conversacion en la catedral">
          {% elif b.title == "La guerra del fin del mundo" %}
            <img src="https://th.bing.com/th/id/OIP.pfHWLHLxQJQZE_neR0tySAHaKg?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="La guerra del fin del mundo">
          {% elif b.title == "El coronel no tiene quien le escriba" %}
            <img src="https://th.bing.com/th/id/OIP.dPQy9Ubmq9md5IOz-PwlrwHaLu?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El coronel no tiene quien le escriba">
          {% elif b.title == "La muerte de artemio cruz" %}
            <img src="https://i.pinimg.com/736x/6d/54/c4/6d54c46422ca0c5adbbbaeb8b5b60e2b--read-books.jpg" class="card-img-top book-cover" alt="La muerte de artemio cruz">
          {% elif b.title == "El amor, las mujeres y la vida" %}
            <img src="https://th.bing.com/th/id/R.aca11529d81257e17181b032307e8db3?rik=1BdxUKnkTtx4cw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="El amor, las mujeres y la vida">
          {% elif b.title == "Travesuras de la niña maria" %}
            <img src="https://m.media-amazon.com/images/I/81jwoP+udnL._SL1500_.jpg" class="card-img-top book-cover" alt="Travesuras de la niña maria">
          {% elif b.title == "el peregrino" %}
            <img src="https://th.bing.com/th/id/OIP.AcJhs4ChgdjnPK7ojqdOdQAAAA?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="el peregrino">
          {% elif b.title == "la carretera" %}
            <img src="https://th.bing.com/th/id/OIP.f6C5XKO19yRW-2WhxWcXfwHaLQ?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="la carretera">
          {% elif b.title == "El gran Gatsby" %}
            <img src="https://www.capsulasliterarias.com/wp-content/uploads/2023/05/Resumen-de-El-Gran-Gatsby-Francis-Scott-Fitzgerald-200x300.png" class="card-img-top book-cover" alt="El gran Gatsby">
          {% elif b.title == "el diario de ana frank" %}
            <img src="https://th.bing.com/th/id/OIP.8b0n4McpzaDbA9M6QIgMngHaLQ?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="el diario de ana frank">
          {% elif b.title == "Moby dick" %}
            <img src="https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1605824499i/55953683.jpg" class="card-img-top book-cover" alt="Moby dick">
          {% elif b.title == "la isla del tesoro" %}
            <img src="https://th.bing.com/th/id/R.7a7d981b68e54c5a23f59320c0314487?rik=uVTkYqqMMBeTEw&riu=http%3a%2f%2f2.bp.blogspot.com%2f-E1aRK4wKQ-I%2fVpeLb13mnoI%2fAAAAAAABrZc%2fOkI1FoRr4b0%2fs1600%2flaisladeltesoro.jpg&ehk=6dpOvT1uaORgOItT9y%2f0m5qYPo9prYdkoTMt7HB8sys%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="la isla del tesoro">
          {% elif b.title == "Dracula" %}
            <img src="https://th.bing.com/th/id/R.bc631c7e08b2a977de44d053f5fc250c?rik=rHHwWzWoy1VDCw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Dracula">
          {% elif b.title == "El retrato de Dorian Gray" %}
            <img src="https://th.bing.com/th/id/OIP.ZUx5oNHHuuSb12d77_ZfiAHaLu?r=0&o=7rm=3&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El retrato de Dorian Gray">
          {% else %}
            <img src="{{ url_for('static', filename='img/libro.jpeg') }}" class="card-img-top book-cover" alt="Libro">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title text-white book-title">{{ b.title }}</h5>
            <p class="card-text text-white"><small>{{ b.author }}</small></p>
            <p class="card-text"><span class="badge bg-secondary">{{ b.category.name if b.category else 'Sin categoría' }}</span></p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    
    <!-- Libros ocultos inicialmente -->
    {% if books|length > 5 %}
      <div class="row row-cols-1 row-cols-md-5 g-4 mt-2" id="moreBooks" style="display:none;">
        {% for b in books[5:] %}
        <div class="col">
          <div class="card h-100 book-card">
            {% if b.title == "La Casa de los Espíritus" %}
              <img src="https://th.bing.com/th/id/R.54d54b9e47b368c2dcbf822968528a1d?rik=ZWfmTXb8pPqdxw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Casa de los Espíritus">
            {% elif b.title == "Cien Años de Soledad" %}
              <img src="https://th.bing.com/th/id/R.938c16d580f65d466de44d9f2ec98732?rik=kqLcyYNhyB9XcQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Cien Años de Soledad">
            {% elif b.title == "Don Quijote de la Mancha" %}
              <img src="https://th.bing.com/th/id/OIP.p2Qht0iMCaSgQb3wbzHukAHaKN?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Don Quijote de la Mancha">
            {% elif b.title == "El Amor en los Tiempos del Cólera" %}
              <img src="https://th.bing.com/th/id/OIP.AH51t3XXwwUHzBcgAnRyDQHaLY?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="El Amor en los Tiempos del Cólera">
            {% elif b.title == "Pedro Páramo" %}
              <img src="https://th.bing.com/th/id/OIP._idAd91_g_NrtKCHOU3NpQAAAA?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Pedro Páramo">
            {% elif b.title == "Rayuela" %}
              <img src="https://th.bing.com/th/id/R.84d2ad6787f0eab3d2c35097777f1d41?rik=s5tX1clebD77gQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Rayuela">
            {% elif b.title == "La Ciudad y los Perros" %}
              <img src="https://th.bing.com/th/id/R.938c16d580f65d466de44d9f2ec98732?rik=kqLcyYNhyB9XcQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Ciudad y los Perros">
            {% elif b.title == "La Fiesta del Chivo" %}
              <img src="https://th.bing.com/th/id/R.1a5cfca15ff39f234282eb119fd9ee84?rik=iT5fIgNSMrqgdg&riu=http%3a%2f%2f2.bp.blogspot.com%2f-dGgVbVjfd3I%2fWLic0sp9tLI%2fAAAAAAAAHuU%2f3fzfr5883Gs068ZRNGl1HbwRk198uN-IgCK4B%2fs1600%2fla-fiesta-del-chivo.jpg&ehk=J5PI%2fAphwc7z%2bN2XE6bu7oFVw26fCYscXfZRfE1vNN8%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Fiesta del Chivo">
            {% elif b.title == "Crimen y Castigo" %}
              <img src="https://assets-global.website-files.com/6034d7d1f3e0f52c50b2adee/6254541d8ae4df16d4e69bc8_6034d7d1f3e0f54529b2b1a1_Crimen-y-castigo-fiodor-dostoyevski-editorial-alma.jpeg" class="card-img-top book-cover" alt="Crimen y Castigo">
            {% elif b.title == "Madame Bovary" %}
              <img src="https://th.bing.com/th/id/R.bfae76717b0269eeb79b473202a0c47f?rik=AD6SgLhBk9YufA&riu=http%3a%2f%2f2.bp.blogspot.com%2f-dZTo7vFU5ow%2fVgBoP_cpkgI%2fAAAAAAAAE2g%2fF1BlE189YuQ%2fs1600%2fmadame-bovary.jpg&ehk=JPl4eHVX08x5Tgr%2ffPp4KgNO6vMPfdcJhYyUKwXO%2bhw%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Madame Bovary">
            {% elif b.title == "La Metamorfosis" %}
              <img src="https://th.bing.com/th/id/OIP.i7Co-_uepnqacgo9X7Lp2wHaMI?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="La Metamorfosis">
            {% elif b.title == "El Nombre de la Rosa" %}
              <img src="https://pics.filmaffinity.com/El_nombre_de_la_rosa-932325619-large.jpg" class="card-img-top book-cover" alt="El Nombre de la Rosa">
            {% elif b.title == "Las Mil y Una Noches" %}
              <img src="https://th.bing.com/th/id/OIP.c6lMjK5WW7B5coR9RDHUEwHaJ9?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="Las Mil y Una Noches">
            {% elif b.title == "El Señor de los Anillos: La Comunidad del Anillo" %}
              <img src="https://th.bing.com/th/id/OIP.vVvlRPaIUFhjugjPJmjiFQHaLF?rs=1&pid=ImgDetMain" class="card-img-top book-cover" alt="El Señor de los Anillos: La Comunidad del Anillo">
            {% elif b.title == "El Hobbit" %}
              <img src="https://www.estudioenescarlata.com/media/img/portadas/_visd_0001JPG01O5Z.jpg" class="card-img-top book-cover" alt="El Hobbit">
            {% elif b.title == "1984" %}
              <img src="https://m.media-amazon.com/images/I/71kxa1-0mfL.jpg" class="card-img-top book-cover" alt="1984">
            {% elif b.title == "El Túnel" %}
              <img src="https://porqueleer.es/wp-content/uploads/2023/06/El-tunel.jpg" class="card-img-top book-cover" alt="El túnel">
            {% elif b.title == "Ficciones" %}
              <img src="https://th.bing.com/th/id/R.f7836a820665a332a8b3abcc418f446c?rik=Jnu3ZckPOR9Opw&riu=http%3a%2f%2f1.bp.blogspot.com%2f-2V-Ej-Q5Vr4%2fVah77WezXTI%2fAAAAAAAAHdE%2f6jAuqM30438%2fs1600%2flibro_1362275865.jpg&ehk=tLBcZ1PTMEJML3tu7O%2f5VSyCfwRm9YIqG0bX%2bwW625g%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Ficciones">
            {% elif b.title == "El Principito" %}
              <img src="https://th.bing.com/th/id/OIP.Jm3Yn4t7jbAfL2fXF6TUkwHaLX?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El principito">
            {% elif b.title == "Orgullo y Prejuicio" %}
              <img src="https://th.bing.com/th/id/R.c71f4e8aec2d03b0ad7834c89846b50d?rik=yr9NbChLTGEzsA&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Orgullo y Prejuicio">
            {% elif b.title == "La Comunidad del Anillo" %}
              <img src="https://th.bing.com/th/id/R.d60f3156fb891e7a61332ffa0d60c8d2?rik=bSqunlRYGoTimA&riu=http%3a%2f%2f4.bp.blogspot.com%2f-fwBFcc__Igk%2fU4YwkJlz71I%2fAAAAAAAACeA%2fn7nvHR3X1xM%2fs1600%2fLa%2bcomunidad%2bdel%2banillo.jpg&ehk=QZSSga710J%2f3i8PkBSJmpLO%2bcTxeZCkdTIGiTrIKTB4%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La comunidad del anillo">
            {% elif b.title == "Fahrenheit 451" %}
              <img src="https://4.bp.blogspot.com/-1SXcY6CyiSw/WMgz8y01BKI/AAAAAAAAT-o/amOlCA24jMgSJuV8bCQueeWRv-7J5JDuACLcB/s1600/ray-bradbury-fahrenheit-451-libro-portada.jpg" class="card-img-top book-cover" alt="Fahrenheit 451">
            {% elif b.title == "El Aleph" %}
              <img src="https://th.bing.com/th/id/OIP.bJE2g7_HVFBc403Q7CiF7QHaLT?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El Aleph">
            {% elif b.title == "La Sombra del Viento" %}
              <img src="https://th.bing.com/th/id/R.9e164e1d45e52e0884b899450f2bd7d9?rik=Pgqo3wVlZhS%2bBw&riu=http%3a%2f%2f4.bp.blogspot.com%2f-BXXT1uAS9uE%2fU_i2i5W0t6I%2fAAAAAAAAAQ4%2frN2dhlUKFAo%2fs1600%2fla_sombra_del_viento.jpg&ehk=L1nhtFEb4MG7GeI0yjCcVqvbzVcqxVHDzC12QcFz3Mc%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La sombra del Viento">
            {% elif b.title == "Ensayo sobre la Ceguera" %}
              <img src="https://th.bing.com/th/id/OIP.Hes3G_5KdnUScIC2yjU34QHaJ4?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="Ensayo sobre la ceguera">
            {% elif b.title == "La Colmena" %}
              <img src="https://th.bing.com/th/id/OIP.OUS6-YvqEDuNCJphpI_HTwHaMR?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="La colmena">
            {% elif b.title == "La Tregua" %}
              <img src="https://th.bing.com/th/id/R.8f9365979c66a517c64a8a1a80816cf8?rik=LMFprrD2%2btmgWQ&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="La Tregua">
            {% elif b.title == "Conversación en La Catedral" %}
              <img src="https://th.bing.com/th/id/R.6de08f65576e8fcafa6a4d59b56aa5db?rik=EV48Kt%2fH8P2KVA&riu=http%3a%2f%2flabodeteca.com%2fweb%2fwp-content%2fuploads%2f2015%2f01%2fportada-conversacion-catedral_grande-1.jpg&ehk=jKqPrdrb8F0J3IcvtOz7V%2fVr6HWgnoekzfxoylNl51Y%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Conversacion en la catedral">
            {% elif b.title == "La Guerra del Fin del Mundo" %}
              <img src="https://th.bing.com/th/id/OIP.pfHWLHLxQJQZE_neR0tySAHaKg?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="La guerra del fin del mundo">
            {% elif b.title == "El Coronel no Tiene Quien le Escriba" %}
              <img src="https://th.bing.com/th/id/OIP.dPQy9Ubmq9md5IOz-PwlrwHaLu?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El coronel no tiene quien le escriba">
            {% elif b.title == "La Muerte de Artemio Cruz" %}
              <img src="https://i.pinimg.com/736x/6d/54/c4/6d54c46422ca0c5adbbbaeb8b5b60e2b--read-books.jpg" class="card-img-top book-cover" alt="La muerte de artemio cruz">
            {% elif b.title == "El Amor, las Mujeres y la Vida" %}
              <img src="https://th.bing.com/th/id/R.aca11529d81257e17181b032307e8db3?rik=1BdxUKnkTtx4cw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="El amor, las mujeres y la vida">
            {% elif b.title == "Travesuras de la Niña Mala" %}
              <img src="https://m.media-amazon.com/images/I/81jwoP+udnL._SL1500_.jpg" class="card-img-top book-cover" alt="Travesuras de la niña maria">
            {% elif b.title == "El Peregrino" %}
              <img src="https://th.bing.com/th/id/OIP.AcJhs4ChgdjnPK7ojqdOdQAAAA?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="el peregrino">
            {% elif b.title == "La Carretera" %}
              <img src="https://th.bing.com/th/id/OIP.f6C5XKO19yRW-2WhxWcXfwHaLQ?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="la carretera">
            {% elif b.title == "El Gran Gatsby" %}
              <img src="https://www.capsulasliterarias.com/wp-content/uploads/2023/05/Resumen-de-El-Gran-Gatsby-Francis-Scott-Fitzgerald-200x300.png" class="card-img-top book-cover" alt="El gran Gatsby">
            {% elif b.title == "El Diario de Ana Frank" %}
              <img src="https://th.bing.com/th/id/OIP.8b0n4McpzaDbA9M6QIgMngHaLQ?r=0&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="el diario de ana frank">
            {% elif b.title == "Moby-Dick" %}
              <img src="https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1605824499i/55953683.jpg" class="card-img-top book-cover" alt="Moby dick">
            {% elif b.title == "La Isla del Tesoro" %}
              <img src="https://th.bing.com/th/id/R.7a7d981b68e54c5a23f59320c0314487?rik=uVTkYqqMMBeTEw&riu=http%3a%2f%2f2.bp.blogspot.com%2f-E1aRK4wKQ-I%2fVpeLb13mnoI%2fAAAAAAABrZc%2fOkI1FoRr4b0%2fs1600%2flaisladeltesoro.jpg&ehk=6dpOvT1uaORgOItT9y%2f0m5qYPo9prYdkoTMt7HB8sys%3d&risl=&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="la isla del tesoro">
            {% elif b.title == "Drácula" %}
              <img src="https://th.bing.com/th/id/R.bc631c7e08b2a977de44d053f5fc250c?rik=rHHwWzWoy1VDCw&pid=ImgRaw&r=0" class="card-img-top book-cover" alt="Dracula">
            {% elif b.title == "El Retrato de Dorian Gray" %}
              <img src="https://th.bing.com/th/id/OIP.ZUx5oNHHuuSb12d77_ZfiAHaLu?r=0&o=7rm=3&rs=1&pid=ImgDetMain&cb=idpwebpc1" class="card-img-top book-cover" alt="El retrato de Dorian Gray">
            {% else %}
              <img src="{{ url_for('static', filename='img/libro.jpeg') }}" class="card-img-top book-cover" alt="Libro">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title text-white book-title">{{ b.title }}</h5>
              <p class="card-text"><small class="text-muted">{{ b.author }}</small></p>
              <p class="card-text"><span class="badge bg-secondary">{{ b.category.name if b.category else 'Sin categoría' }}</span></p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

            <!-- Botón Ver más -->
            <div class="text-center mt-4">
              <button id="showMoreBtn" class="btn btn-primary btn-glow">Ver más libros</button>
            </div>
          {% endif %}
        {% else %}
          <div class="alert alert-info">No hay libros disponibles en este momento.</div>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- Modal para reportes -->
  <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-white">
        <!-- El contenido se genera dinámicamente -->
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Variables globales
    let currentAction = 'create'; // 'create' o 'edit'
    let currentBookId = null;

    // Elementos del DOM
    const errorAlert = document.getElementById('errorAlert');
    const formContainer = document.getElementById('formContainer');
    const bookForm = document.getElementById('bookForm');
    const btnAddNew = document.getElementById('btnAddNew');
    const btnCancel = document.getElementById('btnCancel');
    const btnSubmit = document.getElementById('btnSubmit');
    const showMoreBtn = document.getElementById('showMoreBtn');
    const moreBooks = document.getElementById('moreBooks');

    // Mostrar error
    function showError(message) {
      errorAlert.textContent = message;
      errorAlert.style.display = 'block';
      setTimeout(() => { errorAlert.style.display = 'none'; }, 5000);
    }

    // Event Listeners
    if (btnAddNew) {
      btnAddNew.addEventListener('click', showCreateForm);
    }

    if (btnCancel) {
      btnCancel.addEventListener('click', resetForm);
    }

    if (btnSubmit) {
      btnSubmit.addEventListener('click', handleSubmit);
    }

    if (showMoreBtn) {
      showMoreBtn.addEventListener('click', function() {
        if (moreBooks) {
          moreBooks.style.display = 'flex';
          this.style.display = 'none';
        }
      });
    }

    // Cargar libros al iniciar (por si hay error en la carga inicial)
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar si hay libros cargados
      const booksContainer = document.getElementById('booksContainer');
      if (booksContainer && booksContainer.children.length === 0) {
        showError('Error al cargar los libros. Por favor intenta recargar la página.');
      }

      // Configurar botones de reportes si es admin
      if (document.querySelector('.report-card')) {
        setupReportButtons();
      }
    });

    // ==================== MANEJO DE REPORTES ====================
    function setupReportButtons() {
      const reportButtons = {
        'Historial de préstamos de un usuario': generateUserLoansReport,
        'Inventario actual de copias disponibles': generateInventoryReport,
        'Usuarios con préstamos activos': generateActiveLoansReport,
        'Usuarios que más han realizado préstamos': generateTopUsersReport
      };

      document.querySelectorAll('.report-card').forEach(card => {
        const title = card.querySelector('.card-title').textContent.trim();
        const button = card.querySelector('.report-btn');
        
        if (reportButtons[title]) {
          button.addEventListener('click', reportButtons[title]);
        }
      });
    }

    // Generar reporte de historial de préstamos de usuario
    async function generateUserLoansReport() {
      try {
        const users = await fetchUsers();
        if (users.length === 0) {
          showError('No se encontraron usuarios');
          return;
        }
        
        showUserSelectionModal(
          users,
          'Historial de préstamos por usuario',
          generateUserLoansReportFinal
        );
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Error al generar el reporte');
      }
    }

    async function generateUserLoansReportFinal(userId) {
      try {
        showLoading('Generando reporte...');
        
        // Generar y descargar reporte
        downloadReport('user_loans', userId);
        
        // Opcional: Mostrar en pantalla también
        const response = await fetch(`/api/reportes/historial-usuario/${userId}`);
        if (!response.ok) throw new Error('Error al generar el reporte');
        
        const data = await response.json();
        displayReportData(data, 'Historial de préstamos');
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Error al generar el reporte');
      } finally {
        hideLoading();
      }
    }

    // Generar reporte de inventario
    async function generateInventoryReport() {
      try {
        showLoading('Generando reporte de inventario...');
        downloadReport('inventory');
        
        // Opcional: Mostrar datos también
        const response = await fetch('/api/reportes/inventario');
        if (!response.ok) throw new Error('Error al generar el reporte');
        
        const data = await response.json();
        displayReportData(data, 'Inventario actual');
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Error al generar el reporte');
      } finally {
        hideLoading();
      }
    }

    // Generar reporte de préstamos activos
    async function generateActiveLoansReport() {
      try {
        showLoading('Generando reporte de préstamos activos...');
        downloadReport('active_loans');
        
        const response = await fetch('/api/reportes/prestamos-activos');
        if (!response.ok) throw new Error('Error al generar el reporte');
        
        const data = await response.json();
        displayReportData(data, 'Préstamos activos');
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Error al generar el reporte');
      } finally {
        hideLoading();
      }
    }

    // Generar reporte de top usuarios
    async function generateTopUsersReport() {
      try {
        showLoading('Generando reporte de top usuarios...');
        downloadReport('top_users');
        
        const response = await fetch('/api/reportes/top-usuarios');
        if (!response.ok) throw new Error('Error al generar el reporte');
        
        const data = await response.json();
        displayReportData(data, 'Top usuarios');
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Error al generar el reporte');
      } finally {
        hideLoading();
      }
    }

    // Mostrar datos del reporte en un modal
    function displayReportData(data, title) {
      // Convertir datos a tabla HTML
      let tableHtml = '';
      
      if (data.length > 0) {
        // Crear encabezados de tabla
        const headers = Object.keys(data[0]);
        tableHtml += `<thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>`;
        
        // Crear filas de datos
        const rows = data.map(item => 
          `<tr>${headers.map(h => `<td>${item[h]}</td>`).join('')}</tr>`
        ).join('');
        tableHtml += `<tbody>${rows}</tbody>`;
      } else {
        tableHtml = '<div class="alert alert-info">No hay datos para mostrar</div>';
      }
      
      const modalContent = `
        <div class="modal-header">
          <h5 class="modal-title">${title}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table table-striped">${tableHtml}</table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" onclick="downloadReport('${title.toLowerCase().replace(/\s+/g, '_')}')">
            Descargar PDF
          </button>
        </div>
      `;
      
      showModal(modalContent);
    }

    // Mostrar modal de selección de usuario
    function showUserSelectionModal(users, title, callback) {
      const options = users.map(user => 
        `<option value="${user.id}">${user.ci} (Usuario #${user.id})</option>`
      ).join('');
      
      const modalContent = `
        <div class="modal-header">
          <h5 class="modal-title">${title}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="userSelect" class="form-label">Seleccione un usuario:</label>
            <select id="userSelect" class="form-select">
              ${options}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="confirmUserSelection('${callback.name}')">
            Generar Reporte
          </button>
        </div>
      `;
      
      showModal(modalContent);
    }

    // Confirmar selección de usuario
    function confirmUserSelection(callbackName) {
      const select = document.getElementById('userSelect');
      const userId = select.value;
      
      // Cerrar modal
      const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
      modal.hide();
      
      // Llamar a la función de callback con el ID seleccionado
      window[callbackName](userId);
    }

    // Mostrar modal genérico
    function showModal(content) {
      const modal = document.getElementById('reportModal');
      const modalContent = modal.querySelector('.modal-content');
      
      modalContent.innerHTML = content;
      
      // Inicializar modal de Bootstrap si está disponible
      if (typeof bootstrap !== 'undefined') {
        new bootstrap.Modal(modal).show();
      } else {
        // Fallback básico si Bootstrap no está disponible
        modal.style.display = 'block';
        modal.querySelector('.btn-close, .btn-secondary').onclick = () => {
          modal.style.display = 'none';
        };
      }
    }

    // Descargar reporte en PDF
    function downloadReport(reportType, userId = null) {
      let url = `/api/reports/download/${reportType}`;
      if (userId) {
        url += `?user_id=${userId}`;
      }
      
      // Abrir en nueva pestaña para descarga
      window.open(url, '_blank');
    }

    // Obtener lista de usuarios
    async function fetchUsers() {
      try {
        const response = await fetch('/api/users');
        if (!response.ok) throw new Error('Error al obtener usuarios');
        return await response.json();
      } catch (error) {
        console.error('Error al obtener usuarios:', error);
        alert('Error al cargar la lista de usuarios');
        return [];
      }
    }

    // Mostrar carga
    function showLoading(message) {
      const loadingDiv = document.getElementById('loadingIndicator') || document.createElement('div');
      loadingDiv.id = 'loadingIndicator';
      loadingDiv.innerHTML = `
        <div class="loading-overlay">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p>${message}</p>
        </div>
      `;
      loadingDiv.style.position = 'fixed';
      loadingDiv.style.top = '0';
      loadingDiv.style.left = '0';
      loadingDiv.style.width = '100%';
      loadingDiv.style.height = '100%';
      loadingDiv.style.backgroundColor = 'rgba(0,0,0,0.5)';
      loadingDiv.style.display = 'flex';
      loadingDiv.style.justifyContent = 'center';
      loadingDiv.style.alignItems = 'center';
      loadingDiv.style.zIndex = '9999';
      loadingDiv.style.color = 'white';
      
      if (!document.getElementById('loadingIndicator')) {
        document.body.appendChild(loadingDiv);
      }
    }

    // Ocultar carga
    function hideLoading() {
      const loadingDiv = document.getElementById('loadingIndicator');
      if (loadingDiv) {
        loadingDiv.remove();
      }
    }

    // Funciones para gestión de libros
    function showCreateForm() {
      currentAction = 'create';
      bookForm.dataset.id = '';
      bookForm.reset();
      btnSubmit.textContent = 'Guardar';
      formContainer.style.display = 'block';
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    async function editBook(id) {
      try {
        currentAction = 'edit';
        currentBookId = id;
        
        const response = await fetch(`/api/libros/${id}`);
        if (!response.ok) throw new Error('Error al cargar el libro');
        
        const book = await response.json();
        
        // Llenar formulario
        bookForm.title.value = book.title;
        bookForm.author.value = book.author;
        bookForm.category.value = book.category_id || '';
        bookForm.description.value = book.description || '';
        bookForm.dataset.id = book.id;
        
        btnSubmit.textContent = 'Actualizar';
        formContainer.style.display = 'block';
        window.scrollTo({top: 0, behavior: 'smooth'});
      } catch (error) {
        console.error('Error al editar libro:', error);
        showError(error.message || 'Error al cargar el libro para edición');
      }
    }

    async function handleSubmit() {
      try {
        const formData = {
          title: bookForm.title.value,
          author: bookForm.author.value,
          category_id: bookForm.category.value || null,
          description: bookForm.description.value
        };

        let url = '/api/libros';
        let method = 'POST';
        
        if (currentAction === 'edit' && currentBookId) {
          url = `/api/libros/${currentBookId}`;
          method = 'PUT';
        }

        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
          credentials: 'include'
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Error al guardar');
        }

        const result = await response.json();
        alert(result.mensaje);
        resetForm();
        window.location.reload(); // Recargar la página para ver cambios
      } catch (error) {
        console.error('Error al guardar libro:', error);
        showError(error.message || 'Error al guardar el libro');
      }
    }

    async function confirmDelete(id) {
      if (!confirm('¿Estás seguro de que deseas eliminar este libro?')) return;
      
      try {
        const response = await fetch(`/api/libros/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Error al eliminar');
        }

        const result = await response.json();
        alert(result.mensaje);
        window.location.reload(); // Recargar la página para ver cambios
      } catch (error) {
        console.error('Error al eliminar libro:', error);
        showError(error.message || 'Error al eliminar el libro');
      }
    }

    function resetForm() {
      bookForm.reset();
      bookForm.dataset.id = '';
      formContainer.style.display = 'none';
      currentAction = 'create';
      currentBookId = null;
    }
  </script>

  <style>
    /* Estilo base mejorado */
    .card-img-top {
      height: 200px;
      object-fit: contain;
      transition: all 0.3s ease;
      filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3));
    }
    
    .book-card {
      background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
      border: 1px solid #2a2a2a;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      overflow: hidden;
      position: relative;
    }
    
    /* Efecto mágico al pasar el mouse */
    .book-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 12px 25px rgba(255, 215, 0, 0.2);
      border-color: #5d4a21;
    }
    
    /* Textos blancos */
    .book-card .card-title,
    .book-card .card-text,
    .book-card small {
      color: white !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }
    
    /* Estilo específico para autores */
    .book-card .card-text small {
      font-family: 'Cinzel', 'Georgia', serif;
      font-size: 0.9rem;
      color: #f8f9fa !important;
      letter-spacing: 0.5px;
    }
    
    /* Título estilo pergamino */
    .book-title {
      font-family: 'Cinzel Decorative', 'Georgia', serif;
      font-weight: bold;
      color: #f8f9fa !important;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
      position: relative;
      padding-bottom: 5px;
    }
    
    .book-title:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 25%;
      width: 50%;
      height: 1px;
      background: linear-gradient(to right, transparent, #ffd700, transparent);
    }
    
    /* Efecto hover en la portada */
    .book-card:hover .book-cover {
      transform: scale(1.05);
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.5));
    }
    
    /* Badge de categoría estilo Hogwarts */
    .book-card .badge.bg-secondary {
      background-color: #5d4a21 !important;
      color: #ffd700 !important;
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      border: 1px solid #ffd70033;
    }
    
    /* Fondo con textura de pergamino */
    .books-container {
      background-image: url('https://www.transparenttextures.com/patterns/black-paper.png');
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
    }
    
    /* Efecto de luz dorada al pasar el mouse */
    .book-card:hover:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(255, 215, 0, 0.05) 0%, transparent 70%);
      pointer-events: none;
    }
    
    /* Tipografía Harry Potter */
    @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;700&display=swap');
</style>
{% endblock %}