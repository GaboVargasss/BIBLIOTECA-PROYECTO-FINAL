{% extends 'base.html' %}
{% block title %}Libros ‚Äì Hogwarts & Books{% endblock %}

{% block content %}
  <h2 class="mb-4">Gesti√≥n de Libros</h2>

  {% if role=='admin' %}
    <div class="mb-4 text-center">
      <button id="btnAddNew" class="btn btn-success">‚ûï Agregar libro</button>
    </div>
  {% endif %}

  <!-- Formulario oculto para a√±adir/editar -->
  <div id="formContainer" class="card-form mb-5" style="display:none;">
    <form id="bookForm" data-id="">
      {{ form.hidden_tag() }}
      <div class="row g-3">
        <div class="col-md-4">
          {{ form.title.label(class="form-label") }}
          {{ form.title(class="form-control") }}
        </div>
        <div class="col-md-4">
          {{ form.author.label(class="form-label") }}
          {{ form.author(class="form-control") }}
        </div>
        <div class="col-md-4">
          {{ form.category.label(class="form-label") }}
          {{ form.category(class="form-select") }}
        </div>
        <div class="col-12">
          {{ form.description.label(class="form-label") }}
          {{ form.description(class="form-control", rows=2) }}
        </div>
        <div class="col-12 text-end">
          <button type="button" id="btnCancel" class="btn btn-secondary me-2">Cancelar</button>
          {{ form.submit(class="btn btn-custom") }}
        </div>
      </div>
    </form>
  </div>

  <!-- Tabla de libros -->
  <div class="card p-4">
    <table id="booksTable" class="table table-dark table-striped">
      <thead>
        <tr>
          <th>ID</th><th>T√≠tulo</th><th>Autor</th><th>Categor√≠a</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for b in books %}
        <tr>
          <td>{{ b.id }}</td>
          <td>{{ b.title }}</td>
          <td>{{ b.author }}</td>
          <td>{{ b.category or '‚Äî' }}</td>
          <td>
            {% if role=='admin' %}
              <button class="btn btn-sm btn-warning" onclick="editBook({{ b.id }})">‚úèÔ∏è</button>
              <button class="btn btn-sm btn-danger" onclick="deleteBook({{ b.id }})">üóëÔ∏è</button>
            {% else %}
              <span class="text-muted">‚Äî</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    document.getElementById('btnAddNew')?.addEventListener('click',()=>{
      document.getElementById('formContainer').style.display = 'block';
      window.scrollTo({top:0,behavior:'smooth'});
    });
    document.getElementById('btnCancel')?.addEventListener('click',()=>{
      document.getElementById('formContainer').style.display = 'none';
      document.getElementById('bookForm').reset();
      delete document.getElementById('bookForm').dataset.id;
    });
  </script>
{% endblock %}
